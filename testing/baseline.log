lawrence@lawrence-MacBookAir:~/src/littercoin/scripts$ ./mint-tx.sh preprod
+ '[' -z preprod ']'
+ ENV=preprod
+++ readlink -f ./mint-tx.sh
++ dirname /home/lawrence/src/littercoin/scripts/mint-tx.sh
+ MY_DIR=/home/lawrence/src/littercoin/scripts
+ source /home/lawrence/src/littercoin/scripts/preprod/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export BASE=/home/lawrence/src/littercoin
++ BASE=/home/lawrence/src/littercoin
++ export WORK=/home/lawrence/src/littercoin/work
++ WORK=/home/lawrence/src/littercoin/work
++ export CARDANO_CLI=/usr/local/bin/cardano-cli
++ CARDANO_CLI=/usr/local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ export TESTNET_MAGIC=1
++ TESTNET_MAGIC=1
++ export ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/key.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/key.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/key.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/key.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/key.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/key.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export MIN_ADA_OUTPUT_TX_REF=30000000
++ MIN_ADA_OUTPUT_TX_REF=30000000
++ export COLLATERAL_ADA=5000000
++ COLLATERAL_ADA=5000000
++ export LC_VAL_REF_SCRIPT=c89c8d8d9188a66f7f207288b588335f45c3f6b2ed001c475591cefaa7434f40#2
++ LC_VAL_REF_SCRIPT=c89c8d8d9188a66f7f207288b588335f45c3f6b2ed001c475591cefaa7434f40#2
++ export LC_MINT_REF_SCRIPT=c89c8d8d9188a66f7f207288b588335f45c3f6b2ed001c475591cefaa7434f40#3
++ LC_MINT_REF_SCRIPT=c89c8d8d9188a66f7f207288b588335f45c3f6b2ed001c475591cefaa7434f40#3
++ export MERCHANT_TOKEN_MPH=e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b
++ MERCHANT_TOKEN_MPH=e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b
++ export MERCHANT_TOKEN_NAME=4d65726368616e7420546f6b656e204c6974746572636f696e
++ MERCHANT_TOKEN_NAME=4d65726368616e7420546f6b656e204c6974746572636f696e
++ export BECH32=/usr/local/bin/bech32
++ BECH32=/usr/local/bin/bech32
++ export ADDR_PREFIX=addr_test
++ ADDR_PREFIX=addr_test
++ export BECH32_NETWORK=00
++ BECH32_NETWORK=00
+ '[' preprod == mainnet ']'
+ network='--testnet-magic 1'
+ echo 'Socket path: /home/lawrence/preprod/node.socket'
Socket path: /home/lawrence/preprod/node.socket
+ ls -al /home/lawrence/preprod/node.socket
srw------- 1 lawrence lawrence 0 Dec  8 08:00 /home/lawrence/preprod/node.socket
+ mkdir -p /home/lawrence/src/littercoin/work
+ mkdir -p /home/lawrence/src/littercoin/work-backup
+ rm -f /home/lawrence/src/littercoin/work/admin-utxo-collateral-valid.json /home/lawrence/src/littercoin/work/admin-utxo-valid.json /home/lawrence/src/littercoin/work/admin-utxo.json /home/lawrence/src/littercoin/work/lc-datum-in.json /home/lawrence/src/littercoin/work/lc-datum-out.json /home/lawrence/src/littercoin/work/lc-validator-utxo.json /home/lawrence/src/littercoin/work/pparms.json /home/lawrence/src/littercoin/work/redeemer-mint.json
+ rm -f '/home/lawrence/src/littercoin/work-backup/*'
+ /usr/local/bin/cardano-cli query protocol-parameters --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/pparms.json
+ thread_token_script=/home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.plutus
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.hash
+ thread_token_mph=81120e7758f696deabdddc71ed250e5de11240cb92e5ef1e75e25a44
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/tt-token-name.json
++ jq -r .bytes
+ thread_token_name=54687265616420546f6b656e204c6974746572636f696e
+ lc_validator_script=/home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus
++ /usr/local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus --testnet-magic 1
+ lc_validator_script_addr=addr_test1wz9e9a6vxwusjruhkt57f8ey26y46gh23gh50jsht3hrxgcwzyepp
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.hash
+ lc_validator_hash=8b92f74c33b9090f97b2e9e49f2456895d22ea8a2f47ca175c6e3323
+ lc_mint_script=/home/lawrence/src/littercoin/scripts/preprod/data/lc-minting-policy.plutus
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/lc-minting-policy.hash
+ lc_mint_mph=e28e2d7cc7ec3db5e8568ec76cce0955650ad88dd97987a08986d119
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/lc-token-name.json
++ jq -r .bytes
+ lc_token_name=4c6974746572636f696e
+ redeemer_mint_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/redeemer-mint.json
+ redeemer_val_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/redeemer-val-mint.json
+ metadata_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/lc-token-metadata.json
++ cat /home/lawrence/.local/keys/testnet/admin/key.pkh
+ admin_pkh=b9abcf6867519e28042048aa11207214a52e6d5d3288b752d1c27682
+ echo 'starting littercoin mint-tx.sh'
starting littercoin mint-tx.sh
+ lc_amount=25
++ /usr/local/bin/cardano-cli address build --testnet-magic 1 --payment-verification-key-file /home/lawrence/.local/keys/testnet/admin/key.vkey
+ admin_utxo_addr=addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7
+ /usr/local/bin/cardano-cli query utxo --address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --cardano-mode --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/admin-utxo.json
+ cat /home/lawrence/src/littercoin/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo bce30824952462e5494db481961e4c1acd6a1b7020a5850c9d4fa92cc1d94cc8#0
++ tr -d '\n'
+ admin_utxo_in=bce30824952462e5494db481961e4c1acd6a1b7020a5850c9d4fa92cc1d94cc8#0
+ cat /home/lawrence/src/littercoin/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace == 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0
++ tr -d '\n'
+ admin_utxo_collateral_in=b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0
+ /usr/local/bin/cardano-cli query utxo --address addr_test1wz9e9a6vxwusjruhkt57f8ey26y46gh23gh50jsht3hrxgcwzyepp --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/lc-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."81120e7758f696deabdddc71ed250e5de11240cb92e5ef1e75e25a44"."54687265616420546f6b656e204c6974746572636f696e") 
| .key' /home/lawrence/src/littercoin/work/lc-validator-utxo.json
+ lc_validator_utxo_tx_in=bce30824952462e5494db481961e4c1acd6a1b7020a5850c9d4fa92cc1d94cc8#1
++ jq -r 'to_entries[] 
| select(.value.value."81120e7758f696deabdddc71ed250e5de11240cb92e5ef1e75e25a44"."54687265616420546f6b656e204c6974746572636f696e") 
| .value.inlineDatum' /home/lawrence/src/littercoin/work/lc-validator-utxo.json
+ lc_validator_datum_in='{
  "list": [
    {
      "int": 10000000
    },
    {
      "int": 0
    }
  ]
}'
+ echo -n '{
  "list": [
    {
      "int": 10000000
    },
    {
      "int": 0
    }
  ]
}'
++ jq -r '.list[0].int' /home/lawrence/src/littercoin/work/lc-datum-in.json
+ total_ada=10000000
++ jq -r '.list[1].int' /home/lawrence/src/littercoin/work/lc-datum-in.json
+ total_lc=0
+ new_total_lc=25
+ cat /home/lawrence/src/littercoin/work/lc-datum-in.json
+ jq -c '
  .list[1].int   |= 25'
+ cat /home/lawrence/src/littercoin/scripts/preprod/data/redeemer-mint.json
+ jq -c '
  .fields[0].bytes         |= "8b92f74c33b9090f97b2e9e49f2456895d22ea8a2f47ca175c6e3323"'
+ /usr/local/bin/cardano-cli transaction build --babbage-era --cardano-mode --testnet-magic 1 --change-address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --tx-in-collateral b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0 --tx-in bce30824952462e5494db481961e4c1acd6a1b7020a5850c9d4fa92cc1d94cc8#0 --tx-in bce30824952462e5494db481961e4c1acd6a1b7020a5850c9d4fa92cc1d94cc8#1 --spending-tx-in-reference c89c8d8d9188a66f7f207288b588335f45c3f6b2ed001c475591cefaa7434f40#2 --spending-plutus-script-v2 --spending-reference-tx-in-inline-datum-present --spending-reference-tx-in-redeemer-file /home/lawrence/src/littercoin/scripts/preprod/data/redeemer-val-mint.json --mint '25 e28e2d7cc7ec3db5e8568ec76cce0955650ad88dd97987a08986d119.4c6974746572636f696e' --mint-tx-in-reference c89c8d8d9188a66f7f207288b588335f45c3f6b2ed001c475591cefaa7434f40#3 --mint-plutus-script-v2 --mint-reference-tx-in-redeemer-file /home/lawrence/src/littercoin/work/redeemer-mint.json --policy-id e28e2d7cc7ec3db5e8568ec76cce0955650ad88dd97987a08986d119 --tx-out 'addr_test1wz9e9a6vxwusjruhkt57f8ey26y46gh23gh50jsht3hrxgcwzyepp+10000000 + 1 81120e7758f696deabdddc71ed250e5de11240cb92e5ef1e75e25a44.54687265616420546f6b656e204c6974746572636f696e' --tx-out-inline-datum-file /home/lawrence/src/littercoin/work/lc-datum-out.json --tx-out 'addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7+2000000 + 25 e28e2d7cc7ec3db5e8568ec76cce0955650ad88dd97987a08986d119.4c6974746572636f696e' --required-signer-hash b9abcf6867519e28042048aa11207214a52e6d5d3288b752d1c27682 --protocol-params-file /home/lawrence/src/littercoin/work/pparms.json --calculate-plutus-script-cost /home/lawrence/src/littercoin/scripts/preprod/data/mint-tx.costs
Estimated transaction fee: Lovelace 404453
+ echo 'tx has been built'
tx has been built
lawrence@lawrence-MacBookAir:~/src/littercoin/scripts$ more /home/lawrence/src/littercoin/scripts/preprod/data/mint-tx.costs
[
    {
        "executionUnits": {
            "memory": 786864,
            "steps": 277877754
        },
        "lovelaceCost": 65438,
        "scriptHash": "e28e2d7cc7ec3db5e8568ec76cce0955650ad88dd97987a08986d119"
    },
    {
        "executionUnits": {
            "memory": 1700793,
            "steps": 622562993
        },
        "lovelaceCost": 143023,
        "scriptHash": "8b92f74c33b9090f97b2e9e49f2456895d22ea8a2f47ca175c6e3323"
    }
]
lawrence@lawrence-MacBookAir:~/src/littercoin/scripts$ ls -l preprod/data/
total 80
-rw-rw-r-- 1 lawrence lawrence   33 Dec  8 14:57 lc-datum-init.json
-rw-rw-r-- 1 lawrence lawrence   64 Dec  8 14:59 lc-minting-policy.addr
-rw-rw-r-- 1 lawrence lawrence   56 Dec  8 14:57 lc-minting-policy.hash
-rw-rw-r-- 1 lawrence lawrence 2858 Dec  8 14:57 lc-minting-policy.plutus
-rw-rw-r-- 1 lawrence lawrence  621 Dec  8 14:57 lc-token-metadata.json
-rw-rw-r-- 1 lawrence lawrence   33 Dec  8 14:57 lc-token-name.json
-rw-rw-r-- 1 lawrence lawrence   64 Dec  8 15:00 lc-validator.addr
-rw-rw-r-- 1 lawrence lawrence   56 Dec  8 14:57 lc-validator.hash
-rw-rw-r-- 1 lawrence lawrence 6244 Dec  8 14:57 lc-validator.plutus
-rw------- 1 lawrence lawrence  454 Dec  8 15:02 mint-tx.costs
-rw-rw-r-- 1 lawrence lawrence   32 Dec  8 14:57 redeemer-add-ada.json
-rw-rw-r-- 1 lawrence lawrence   51 Dec  8 14:57 redeemer-burn.json
-rw-rw-r-- 1 lawrence lawrence   32 Dec  8 14:57 redeemer-init.json
-rw-rw-r-- 1 lawrence lawrence   51 Dec  8 14:57 redeemer-mint.json
-rw-rw-r-- 1 lawrence lawrence   51 Dec  8 14:57 redeemer-val-burn.json
-rw-rw-r-- 1 lawrence lawrence   32 Dec  8 14:57 redeemer-val-mint.json
-rw-rw-r-- 1 lawrence lawrence   56 Dec  8 14:57 tt-minting-policy.hash
-rw-rw-r-- 1 lawrence lawrence 1948 Dec  8 14:57 tt-minting-policy.plutus
-rw-rw-r-- 1 lawrence lawrence   59 Dec  8 14:57 tt-token-name.json
lawrence@lawrence-MacBookAir:~/src/littercoin/scripts$ 

