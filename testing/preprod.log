########################################################################
########################################################################
# Littercoin Testing Log - Helios Implementation
# Dec 8, 2022
########################################################################
########################################################################



########################################################################
# init-tx.sh - Inialize the smart contract datum, lock the thread token to 
# the smart contract and load both the validator and minting policy
# onchain as a reference scripts.
########################################################################


lawrence@lawrence-MacBookAir:~/src/littercoin/scripts$ ./init-tx.sh preprod
+ '[' -z preprod ']'
+ ENV=preprod
+++ readlink -f ./init-tx.sh
++ dirname /home/lawrence/src/littercoin/scripts/init-tx.sh
+ MY_DIR=/home/lawrence/src/littercoin/scripts
+ source /home/lawrence/src/littercoin/scripts/preprod/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export BASE=/home/lawrence/src/littercoin
++ BASE=/home/lawrence/src/littercoin
++ export WORK=/home/lawrence/src/littercoin/work
++ WORK=/home/lawrence/src/littercoin/work
++ export CARDANO_CLI=/usr/local/bin/cardano-cli
++ CARDANO_CLI=/usr/local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ export TESTNET_MAGIC=1
++ TESTNET_MAGIC=1
++ export ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/key.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/key.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/key.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/key.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/key.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/key.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export MIN_ADA_OUTPUT_TX_REF=30000000
++ MIN_ADA_OUTPUT_TX_REF=30000000
++ export COLLATERAL_ADA=5000000
++ COLLATERAL_ADA=5000000
++ export LC_VAL_REF_SCRIPT=9a630fc1090b7382885aa153aab377cd8b1874faf23198992930ac093f5ce36a#2
++ LC_VAL_REF_SCRIPT=9a630fc1090b7382885aa153aab377cd8b1874faf23198992930ac093f5ce36a#2
++ export LC_MINT_REF_SCRIPT=9a630fc1090b7382885aa153aab377cd8b1874faf23198992930ac093f5ce36a#3
++ LC_MINT_REF_SCRIPT=9a630fc1090b7382885aa153aab377cd8b1874faf23198992930ac093f5ce36a#3
++ export MERCHANT_TOKEN_MPH=e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b
++ MERCHANT_TOKEN_MPH=e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b
++ export MERCHANT_TOKEN_NAME=4d65726368616e7420546f6b656e204c6974746572636f696e
++ MERCHANT_TOKEN_NAME=4d65726368616e7420546f6b656e204c6974746572636f696e
++ export BECH32=/usr/local/bin/bech32
++ BECH32=/usr/local/bin/bech32
++ export ADDR_PREFIX=addr_test
++ ADDR_PREFIX=addr_test
++ export BECH32_NETWORK=00
++ BECH32_NETWORK=00
+ '[' preprod == mainnet ']'
+ network='--testnet-magic 1'
+ echo 'Socket path: /home/lawrence/preprod/node.socket'
Socket path: /home/lawrence/preprod/node.socket
+ ls -al /home/lawrence/preprod/node.socket
srw------- 1 lawrence lawrence 0 Dec  8 08:00 /home/lawrence/preprod/node.socket
+ mkdir -p /home/lawrence/src/littercoin/work
+ mkdir -p /home/lawrence/src/littercoin/work-backup
+ rm -f /home/lawrence/src/littercoin/work/admin-utxo-collateral-valid.json /home/lawrence/src/littercoin/work/admin-utxo-valid.json /home/lawrence/src/littercoin/work/admin-utxo.json /home/lawrence/src/littercoin/work/merchant-token-alonzo.body /home/lawrence/src/littercoin/work/merchant-token-alonzo.tx /home/lawrence/src/littercoin/work/pparms.json
+ rm -f '/home/lawrence/src/littercoin/work-backup/*'
+ /usr/local/bin/cardano-cli query protocol-parameters --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/pparms.json
+ thread_token_script=/home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.plutus
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.hash
+ thread_token_mph=e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/tt-token-name.json
++ jq -r .bytes
+ thread_token_name=54687265616420546f6b656e204c6974746572636f696e
+ lc_validator_script=/home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus
++ /usr/local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus --testnet-magic 1
+ lc_validator_script_addr=addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l
+ redeemer_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/redeemer-init.json
+ lc_mint_script=/home/lawrence/src/littercoin/scripts/preprod/data/lc-minting-policy.plutus
++ /usr/local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/littercoin/scripts/preprod/data/lc-minting-policy.plutus --testnet-magic 1
+ lc_mint_script_addr=addr_test1wpnle7pt72q9pc8mz6pdf6u6p45p32zaneyeyu6xqegd47sawy22v
+ echo 'starting littercoin init-tx.sh'
starting littercoin init-tx.sh
+ echo addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l
+ echo addr_test1wpnle7pt72q9pc8mz6pdf6u6p45p32zaneyeyu6xqegd47sawy22v
++ /usr/local/bin/cardano-cli address build --testnet-magic 1 --payment-verification-key-file /home/lawrence/.local/keys/testnet/admin/key.vkey
+ admin_utxo_addr=addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7
+ /usr/local/bin/cardano-cli query utxo --address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --cardano-mode --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/admin-utxo.json
+ cat /home/lawrence/src/littercoin/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 57cd9395c30985c4f5850b97fd42ab72750fe37700256549f4476626ef9338b2#0
++ tr -d '\n'
+ admin_utxo_in=57cd9395c30985c4f5850b97fd42ab72750fe37700256549f4476626ef9338b2#0
+ cat /home/lawrence/src/littercoin/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace == 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0
++ tr -d '\n'
+ admin_utxo_collateral_in=b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0
+ /usr/local/bin/cardano-cli transaction build --babbage-era --cardano-mode --testnet-magic 1 --change-address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --tx-in-collateral b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0 --tx-in 57cd9395c30985c4f5850b97fd42ab72750fe37700256549f4476626ef9338b2#0 --mint '1 e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858.54687265616420546f6b656e204c6974746572636f696e' --mint-script-file /home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.plutus --mint-redeemer-file /home/lawrence/src/littercoin/scripts/preprod/data/redeemer-init.json --tx-out 'addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l+2000000 + 1 e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858.54687265616420546f6b656e204c6974746572636f696e' --tx-out-inline-datum-file /home/lawrence/src/littercoin/scripts/preprod/data/lc-datum-init.json --tx-out addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l+30000000 --tx-out-reference-script-file /home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus --tx-out addr_test1wpnle7pt72q9pc8mz6pdf6u6p45p32zaneyeyu6xqegd47sawy22v+30000000 --tx-out-reference-script-file /home/lawrence/src/littercoin/scripts/preprod/data/lc-minting-policy.plutus --protocol-params-file /home/lawrence/src/littercoin/work/pparms.json --out-file /home/lawrence/src/littercoin/work/init-tx-alonzo.body
Estimated transaction fee: Lovelace 442724
+ echo 'tx has been built'
tx has been built
+ /usr/local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/littercoin/work/init-tx-alonzo.body --testnet-magic 1 --signing-key-file /home/lawrence/.local/keys/testnet/admin/key.skey --out-file /home/lawrence/src/littercoin/work/init-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /usr/local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/littercoin/work/init-tx-alonzo.tx --testnet-magic 1
Transaction successfully submitted.


lawrence@lawrence-iMac:~$ cardano-cli query utxo --address addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l --cardano-mode --testnet-magic 1
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91     1        2000000 lovelace + 1 e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858.54687265616420546f6b656e204c6974746572636f696e + TxOutDatumInline ReferenceTxInsScriptsInlineDatumsInBabbageEra (ScriptDataList [ScriptDataNumber 0,ScriptDataNumber 0])
03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91     2        30000000 lovelace + TxOutDatumNone




########################################################################
# add-ada-tx.sh - Add Ada to the smart contract and update the datum with
# the new Ada amount.
########################################################################


lawrence@lawrence-MacBookAir:~/src/littercoin/scripts$ ./add-ada-tx.sh preprod
+ '[' -z preprod ']'
+ ENV=preprod
+++ readlink -f ./add-ada-tx.sh
++ dirname /home/lawrence/src/littercoin/scripts/add-ada-tx.sh
+ MY_DIR=/home/lawrence/src/littercoin/scripts
+ source /home/lawrence/src/littercoin/scripts/preprod/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export BASE=/home/lawrence/src/littercoin
++ BASE=/home/lawrence/src/littercoin
++ export WORK=/home/lawrence/src/littercoin/work
++ WORK=/home/lawrence/src/littercoin/work
++ export CARDANO_CLI=/usr/local/bin/cardano-cli
++ CARDANO_CLI=/usr/local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ export TESTNET_MAGIC=1
++ TESTNET_MAGIC=1
++ export ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/key.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/key.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/key.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/key.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/key.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/key.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export MIN_ADA_OUTPUT_TX_REF=30000000
++ MIN_ADA_OUTPUT_TX_REF=30000000
++ export COLLATERAL_ADA=5000000
++ COLLATERAL_ADA=5000000
++ export LC_VAL_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2
++ LC_VAL_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2
++ export LC_MINT_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3
++ LC_MINT_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3
++ export MERCHANT_TOKEN_MPH=e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b
++ MERCHANT_TOKEN_MPH=e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b
++ export MERCHANT_TOKEN_NAME=4d65726368616e7420546f6b656e204c6974746572636f696e
++ MERCHANT_TOKEN_NAME=4d65726368616e7420546f6b656e204c6974746572636f696e
++ export BECH32=/usr/local/bin/bech32
++ BECH32=/usr/local/bin/bech32
++ export ADDR_PREFIX=addr_test
++ ADDR_PREFIX=addr_test
++ export BECH32_NETWORK=00
++ BECH32_NETWORK=00
+ '[' preprod == mainnet ']'
+ network='--testnet-magic 1'
+ echo 'Socket path: /home/lawrence/preprod/node.socket'
Socket path: /home/lawrence/preprod/node.socket
+ ls -al /home/lawrence/preprod/node.socket
srw------- 1 lawrence lawrence 0 Dec  8 08:00 /home/lawrence/preprod/node.socket
+ mkdir -p /home/lawrence/src/littercoin/work
+ mkdir -p /home/lawrence/src/littercoin/work-backup
+ rm -f /home/lawrence/src/littercoin/work/admin-utxo-collateral-valid.json /home/lawrence/src/littercoin/work/admin-utxo-valid.json /home/lawrence/src/littercoin/work/admin-utxo.json /home/lawrence/src/littercoin/work/init-tx-alonzo.body /home/lawrence/src/littercoin/work/init-tx-alonzo.tx /home/lawrence/src/littercoin/work/pparms.json
+ rm -f '/home/lawrence/src/littercoin/work-backup/*'
+ /usr/local/bin/cardano-cli query protocol-parameters --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/pparms.json
+ thread_token_script=/home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.plutus
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.hash
+ thread_token_mph=e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/tt-token-name.json
++ jq -r .bytes
+ thread_token_name=54687265616420546f6b656e204c6974746572636f696e
+ lc_validator_script=/home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus
++ /usr/local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus --testnet-magic 1
+ lc_validator_script_addr=addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l
+ redeemer_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/redeemer-add-ada.json
+ ada_amount=10000000
+ echo 'starting littercoin add-ada-tx.sh'
starting littercoin add-ada-tx.sh
+ echo addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l
++ /usr/local/bin/cardano-cli address build --testnet-magic 1 --payment-verification-key-file /home/lawrence/.local/keys/testnet/admin/key.vkey
+ admin_utxo_addr=addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7
+ /usr/local/bin/cardano-cli query utxo --address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --cardano-mode --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/admin-utxo.json
+ cat /home/lawrence/src/littercoin/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#0
++ tr -d '\n'
+ admin_utxo_in=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#0
+ cat /home/lawrence/src/littercoin/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace == 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0
++ tr -d '\n'
+ admin_utxo_collateral_in=b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0
+ /usr/local/bin/cardano-cli query utxo --address addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/lc-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858"."54687265616420546f6b656e204c6974746572636f696e") 
| .key' /home/lawrence/src/littercoin/work/lc-validator-utxo.json
+ lc_validator_utxo_tx_in=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#1
++ jq -r 'to_entries[] 
| select(.value.value."e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858"."54687265616420546f6b656e204c6974746572636f696e") 
| .value.inlineDatum' /home/lawrence/src/littercoin/work/lc-validator-utxo.json
+ lc_validator_datum_in='{
  "list": [
    {
      "int": 0
    },
    {
      "int": 0
    }
  ]
}'
+ echo -n '{
  "list": [
    {
      "int": 0
    },
    {
      "int": 0
    }
  ]
}'
++ jq -r '.list[0].int' /home/lawrence/src/littercoin/work/lc-datum-in.json
+ total_ada=0
+ new_total_ada=10000000
+ cat /home/lawrence/src/littercoin/work/lc-datum-in.json
+ jq -c '
  .list[0].int   |= 10000000'
+ /usr/local/bin/cardano-cli transaction build --babbage-era --cardano-mode --testnet-magic 1 --change-address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --tx-in-collateral b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0 --tx-in 03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#0 --tx-in 03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#1 --spending-tx-in-reference 03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2 --spending-plutus-script-v2 --spending-reference-tx-in-inline-datum-present --spending-reference-tx-in-redeemer-file /home/lawrence/src/littercoin/scripts/preprod/data/redeemer-add-ada.json --tx-out 'addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l+10000000 + 1 e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858.54687265616420546f6b656e204c6974746572636f696e' --tx-out-inline-datum-file /home/lawrence/src/littercoin/work/lc-datum-out.json --protocol-params-file /home/lawrence/src/littercoin/work/pparms.json --out-file /home/lawrence/src/littercoin/work/add-ada-tx-alonzo.body
Estimated transaction fee: Lovelace 285762
+ echo 'tx has been built'
tx has been built
+ /usr/local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/littercoin/work/add-ada-tx-alonzo.body --testnet-magic 1 --signing-key-file /home/lawrence/.local/keys/testnet/admin/key.skey --out-file /home/lawrence/src/littercoin/work/add-ada-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /usr/local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/littercoin/work/add-ada-tx-alonzo.tx --testnet-magic 1
Transaction successfully submitted.


lawrence@lawrence-iMac:~$ cardano-cli query utxo --address addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l --cardano-mode --testnet-magic 1
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91     2        30000000 lovelace + TxOutDatumNone
51ba1fa352c6c56745b992a04b4ea76b1a2cb117a5361c818acbe3381436f11e     1        10000000 lovelace + 1 e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858.54687265616420546f6b656e204c6974746572636f696e + TxOutDatumInline ReferenceTxInsScriptsInlineDatumsInBabbageEra (ScriptDataList [ScriptDataNumber 10000000,ScriptDataNumber 0])

##################################
#Doing it a second time as well
###################################

lawrence@lawrence-MacBookAir:~/src/littercoin/scripts$ ./add-ada-tx.sh preprod
+ '[' -z preprod ']'
+ ENV=preprod
+++ readlink -f ./add-ada-tx.sh
++ dirname /home/lawrence/src/littercoin/scripts/add-ada-tx.sh
+ MY_DIR=/home/lawrence/src/littercoin/scripts
+ source /home/lawrence/src/littercoin/scripts/preprod/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export BASE=/home/lawrence/src/littercoin
++ BASE=/home/lawrence/src/littercoin
++ export WORK=/home/lawrence/src/littercoin/work
++ WORK=/home/lawrence/src/littercoin/work
++ export CARDANO_CLI=/usr/local/bin/cardano-cli
++ CARDANO_CLI=/usr/local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ export TESTNET_MAGIC=1
++ TESTNET_MAGIC=1
++ export ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/key.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/key.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/key.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/key.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/key.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/key.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export MIN_ADA_OUTPUT_TX_REF=30000000
++ MIN_ADA_OUTPUT_TX_REF=30000000
++ export COLLATERAL_ADA=5000000
++ COLLATERAL_ADA=5000000
++ export LC_VAL_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2
++ LC_VAL_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2
++ export LC_MINT_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3
++ LC_MINT_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3
++ export MERCHANT_TOKEN_MPH=e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b
++ MERCHANT_TOKEN_MPH=e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b
++ export MERCHANT_TOKEN_NAME=4d65726368616e7420546f6b656e204c6974746572636f696e
++ MERCHANT_TOKEN_NAME=4d65726368616e7420546f6b656e204c6974746572636f696e
++ export BECH32=/usr/local/bin/bech32
++ BECH32=/usr/local/bin/bech32
++ export ADDR_PREFIX=addr_test
++ ADDR_PREFIX=addr_test
++ export BECH32_NETWORK=00
++ BECH32_NETWORK=00
+ '[' preprod == mainnet ']'
+ network='--testnet-magic 1'
+ echo 'Socket path: /home/lawrence/preprod/node.socket'
Socket path: /home/lawrence/preprod/node.socket
+ ls -al /home/lawrence/preprod/node.socket
srw------- 1 lawrence lawrence 0 Dec  8 08:00 /home/lawrence/preprod/node.socket
+ mkdir -p /home/lawrence/src/littercoin/work
+ mkdir -p /home/lawrence/src/littercoin/work-backup
+ rm -f /home/lawrence/src/littercoin/work/add-ada-tx-alonzo.body /home/lawrence/src/littercoin/work/add-ada-tx-alonzo.tx /home/lawrence/src/littercoin/work/admin-utxo-collateral-valid.json /home/lawrence/src/littercoin/work/admin-utxo-valid.json /home/lawrence/src/littercoin/work/admin-utxo.json /home/lawrence/src/littercoin/work/lc-datum-in.json /home/lawrence/src/littercoin/work/lc-datum-out.json /home/lawrence/src/littercoin/work/lc-validator-utxo.json /home/lawrence/src/littercoin/work/pparms.json
+ rm -f '/home/lawrence/src/littercoin/work-backup/*'
+ /usr/local/bin/cardano-cli query protocol-parameters --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/pparms.json
+ thread_token_script=/home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.plutus
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.hash
+ thread_token_mph=e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/tt-token-name.json
++ jq -r .bytes
+ thread_token_name=54687265616420546f6b656e204c6974746572636f696e
+ lc_validator_script=/home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus
++ /usr/local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus --testnet-magic 1
+ lc_validator_script_addr=addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l
+ redeemer_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/redeemer-add-ada.json
+ ada_amount=10000000
+ echo 'starting littercoin add-ada-tx.sh'
starting littercoin add-ada-tx.sh
+ echo addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l
++ /usr/local/bin/cardano-cli address build --testnet-magic 1 --payment-verification-key-file /home/lawrence/.local/keys/testnet/admin/key.vkey
+ admin_utxo_addr=addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7
+ /usr/local/bin/cardano-cli query utxo --address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --cardano-mode --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/admin-utxo.json
+ cat /home/lawrence/src/littercoin/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 51ba1fa352c6c56745b992a04b4ea76b1a2cb117a5361c818acbe3381436f11e#0
++ tr -d '\n'
+ admin_utxo_in=51ba1fa352c6c56745b992a04b4ea76b1a2cb117a5361c818acbe3381436f11e#0
+ cat /home/lawrence/src/littercoin/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace == 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0
++ tr -d '\n'
+ admin_utxo_collateral_in=b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0
+ /usr/local/bin/cardano-cli query utxo --address addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/lc-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858"."54687265616420546f6b656e204c6974746572636f696e") 
| .key' /home/lawrence/src/littercoin/work/lc-validator-utxo.json
+ lc_validator_utxo_tx_in=51ba1fa352c6c56745b992a04b4ea76b1a2cb117a5361c818acbe3381436f11e#1
++ jq -r 'to_entries[] 
| select(.value.value."e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858"."54687265616420546f6b656e204c6974746572636f696e") 
| .value.inlineDatum' /home/lawrence/src/littercoin/work/lc-validator-utxo.json
+ lc_validator_datum_in='{
  "list": [
    {
      "int": 10000000
    },
    {
      "int": 0
    }
  ]
}'
+ echo -n '{
  "list": [
    {
      "int": 10000000
    },
    {
      "int": 0
    }
  ]
}'
++ jq -r '.list[0].int' /home/lawrence/src/littercoin/work/lc-datum-in.json
+ total_ada=10000000
+ new_total_ada=20000000
+ cat /home/lawrence/src/littercoin/work/lc-datum-in.json
+ jq -c '
  .list[0].int   |= 20000000'
+ /usr/local/bin/cardano-cli transaction build --babbage-era --cardano-mode --testnet-magic 1 --change-address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --tx-in-collateral b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0 --tx-in 51ba1fa352c6c56745b992a04b4ea76b1a2cb117a5361c818acbe3381436f11e#0 --tx-in 51ba1fa352c6c56745b992a04b4ea76b1a2cb117a5361c818acbe3381436f11e#1 --spending-tx-in-reference 03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2 --spending-plutus-script-v2 --spending-reference-tx-in-inline-datum-present --spending-reference-tx-in-redeemer-file /home/lawrence/src/littercoin/scripts/preprod/data/redeemer-add-ada.json --tx-out 'addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l+20000000 + 1 e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858.54687265616420546f6b656e204c6974746572636f696e' --tx-out-inline-datum-file /home/lawrence/src/littercoin/work/lc-datum-out.json --protocol-params-file /home/lawrence/src/littercoin/work/pparms.json --out-file /home/lawrence/src/littercoin/work/add-ada-tx-alonzo.body
Estimated transaction fee: Lovelace 285762
+ echo 'tx has been built'
tx has been built
+ /usr/local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/littercoin/work/add-ada-tx-alonzo.body --testnet-magic 1 --signing-key-file /home/lawrence/.local/keys/testnet/admin/key.skey --out-file /home/lawrence/src/littercoin/work/add-ada-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /usr/local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/littercoin/work/add-ada-tx-alonzo.tx --testnet-magic 1
Transaction successfully submitted.

lawrence@lawrence-iMac:~$ cardano-cli query utxo --address addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l --cardano-mode --testnet-magic 1
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91     2        30000000 lovelace + TxOutDatumNone
c4ca12a6f498ebd5094a125fa70a8b438c9c16f4094433e307c10f3d4bc249f7     1        20000000 lovelace + 1 e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858.54687265616420546f6b656e204c6974746572636f696e + TxOutDatumInline ReferenceTxInsScriptsInlineDatumsInBabbageEra (ScriptDataList [ScriptDataNumber 20000000,ScriptDataNumber 0])



########################################################################
# mint-tx.sh - Mint littercoin using the correct owner pkh.
########################################################################

lawrence@lawrence-MacBookAir:~/src/littercoin/scripts$ ./mint-tx.sh preprod
+ '[' -z preprod ']'
+ ENV=preprod
+++ readlink -f ./mint-tx.sh
++ dirname /home/lawrence/src/littercoin/scripts/mint-tx.sh
+ MY_DIR=/home/lawrence/src/littercoin/scripts
+ source /home/lawrence/src/littercoin/scripts/preprod/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export BASE=/home/lawrence/src/littercoin
++ BASE=/home/lawrence/src/littercoin
++ export WORK=/home/lawrence/src/littercoin/work
++ WORK=/home/lawrence/src/littercoin/work
++ export CARDANO_CLI=/usr/local/bin/cardano-cli
++ CARDANO_CLI=/usr/local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ export TESTNET_MAGIC=1
++ TESTNET_MAGIC=1
++ export ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/key.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/key.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/key.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/key.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/key.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/key.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export MIN_ADA_OUTPUT_TX_REF=30000000
++ MIN_ADA_OUTPUT_TX_REF=30000000
++ export COLLATERAL_ADA=5000000
++ COLLATERAL_ADA=5000000
++ export LC_VAL_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2
++ LC_VAL_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2
++ export LC_MINT_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3
++ LC_MINT_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3
++ export MERCHANT_TOKEN_MPH=e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b
++ MERCHANT_TOKEN_MPH=e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b
++ export MERCHANT_TOKEN_NAME=4d65726368616e7420546f6b656e204c6974746572636f696e
++ MERCHANT_TOKEN_NAME=4d65726368616e7420546f6b656e204c6974746572636f696e
++ export BECH32=/usr/local/bin/bech32
++ BECH32=/usr/local/bin/bech32
++ export ADDR_PREFIX=addr_test
++ ADDR_PREFIX=addr_test
++ export BECH32_NETWORK=00
++ BECH32_NETWORK=00
+ '[' preprod == mainnet ']'
+ network='--testnet-magic 1'
+ echo 'Socket path: /home/lawrence/preprod/node.socket'
Socket path: /home/lawrence/preprod/node.socket
+ ls -al /home/lawrence/preprod/node.socket
srw------- 1 lawrence lawrence 0 Dec  8 08:00 /home/lawrence/preprod/node.socket
+ mkdir -p /home/lawrence/src/littercoin/work
+ mkdir -p /home/lawrence/src/littercoin/work-backup
+ rm -f /home/lawrence/src/littercoin/work/add-ada-tx-alonzo.body /home/lawrence/src/littercoin/work/add-ada-tx-alonzo.tx /home/lawrence/src/littercoin/work/admin-utxo-collateral-valid.json /home/lawrence/src/littercoin/work/admin-utxo-valid.json /home/lawrence/src/littercoin/work/admin-utxo.json /home/lawrence/src/littercoin/work/lc-datum-in.json /home/lawrence/src/littercoin/work/lc-datum-out.json /home/lawrence/src/littercoin/work/lc-validator-utxo.json /home/lawrence/src/littercoin/work/pparms.json
+ rm -f '/home/lawrence/src/littercoin/work-backup/*'
+ /usr/local/bin/cardano-cli query protocol-parameters --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/pparms.json
+ thread_token_script=/home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.plutus
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.hash
+ thread_token_mph=e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/tt-token-name.json
++ jq -r .bytes
+ thread_token_name=54687265616420546f6b656e204c6974746572636f696e
+ lc_validator_script=/home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus
++ /usr/local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus --testnet-magic 1
+ lc_validator_script_addr=addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.hash
+ lc_validator_hash=b368512317c8f9f9408d026705d0a36071a641c9700d4f7865e1fdfa
+ lc_mint_script=/home/lawrence/src/littercoin/scripts/preprod/data/lc-minting-policy.plutus
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/lc-minting-policy.hash
+ lc_mint_mph=67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/lc-token-name.json
++ jq -r .bytes
+ lc_token_name=4c6974746572636f696e
+ redeemer_mint_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/redeemer-mint.json
+ redeemer_val_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/redeemer-val-mint.json
+ metadata_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/lc-token-metadata.json
++ cat /home/lawrence/.local/keys/testnet/admin/key.pkh
+ admin_pkh=b9abcf6867519e28042048aa11207214a52e6d5d3288b752d1c27682
+ echo 'starting littercoin mint-tx.sh'
starting littercoin mint-tx.sh
+ lc_amount=25
++ /usr/local/bin/cardano-cli address build --testnet-magic 1 --payment-verification-key-file /home/lawrence/.local/keys/testnet/admin/key.vkey
+ admin_utxo_addr=addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7
+ /usr/local/bin/cardano-cli query utxo --address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --cardano-mode --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/admin-utxo.json
+ cat /home/lawrence/src/littercoin/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo c4ca12a6f498ebd5094a125fa70a8b438c9c16f4094433e307c10f3d4bc249f7#0
++ tr -d '\n'
+ admin_utxo_in=c4ca12a6f498ebd5094a125fa70a8b438c9c16f4094433e307c10f3d4bc249f7#0
+ cat /home/lawrence/src/littercoin/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace == 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0
++ tr -d '\n'
+ admin_utxo_collateral_in=b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0
+ /usr/local/bin/cardano-cli query utxo --address addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/lc-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858"."54687265616420546f6b656e204c6974746572636f696e") 
| .key' /home/lawrence/src/littercoin/work/lc-validator-utxo.json
+ lc_validator_utxo_tx_in=c4ca12a6f498ebd5094a125fa70a8b438c9c16f4094433e307c10f3d4bc249f7#1
++ jq -r 'to_entries[] 
| select(.value.value."e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858"."54687265616420546f6b656e204c6974746572636f696e") 
| .value.inlineDatum' /home/lawrence/src/littercoin/work/lc-validator-utxo.json
+ lc_validator_datum_in='{
  "list": [
    {
      "int": 20000000
    },
    {
      "int": 0
    }
  ]
}'
+ echo -n '{
  "list": [
    {
      "int": 20000000
    },
    {
      "int": 0
    }
  ]
}'
++ jq -r '.list[0].int' /home/lawrence/src/littercoin/work/lc-datum-in.json
+ total_ada=20000000
++ jq -r '.list[1].int' /home/lawrence/src/littercoin/work/lc-datum-in.json
+ total_lc=0
+ new_total_lc=25
+ cat /home/lawrence/src/littercoin/work/lc-datum-in.json
+ jq -c '
  .list[1].int   |= 25'
+ cat /home/lawrence/src/littercoin/scripts/preprod/data/redeemer-mint.json
+ jq -c '
  .fields[0].bytes         |= "b368512317c8f9f9408d026705d0a36071a641c9700d4f7865e1fdfa"'
+ /usr/local/bin/cardano-cli transaction build --babbage-era --cardano-mode --testnet-magic 1 --change-address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --tx-in-collateral b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0 --tx-in c4ca12a6f498ebd5094a125fa70a8b438c9c16f4094433e307c10f3d4bc249f7#0 --tx-in c4ca12a6f498ebd5094a125fa70a8b438c9c16f4094433e307c10f3d4bc249f7#1 --spending-tx-in-reference 03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2 --spending-plutus-script-v2 --spending-reference-tx-in-inline-datum-present --spending-reference-tx-in-redeemer-file /home/lawrence/src/littercoin/scripts/preprod/data/redeemer-val-mint.json --mint '25 67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa.4c6974746572636f696e' --mint-tx-in-reference 03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3 --mint-plutus-script-v2 --mint-reference-tx-in-redeemer-file /home/lawrence/src/littercoin/work/redeemer-mint.json --policy-id 67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa --tx-out 'addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l+20000000 + 1 e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858.54687265616420546f6b656e204c6974746572636f696e' --tx-out-inline-datum-file /home/lawrence/src/littercoin/work/lc-datum-out.json --tx-out 'addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7+2000000 + 25 67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa.4c6974746572636f696e' --required-signer-hash b9abcf6867519e28042048aa11207214a52e6d5d3288b752d1c27682 --protocol-params-file /home/lawrence/src/littercoin/work/pparms.json --out-file /home/lawrence/src/littercoin/work/mint-tx-alonzo.body
Estimated transaction fee: Lovelace 404453
+ echo 'tx has been built'
tx has been built
+ /usr/local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/littercoin/work/mint-tx-alonzo.body --testnet-magic 1 --signing-key-file /home/lawrence/.local/keys/testnet/admin/key.skey --out-file /home/lawrence/src/littercoin/work/mint-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /usr/local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/littercoin/work/mint-tx-alonzo.tx --testnet-magic 1
Transaction successfully submitted.


lawrence@lawrence-iMac:~$ cardano-cli query utxo --address addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l --cardano-mode --testnet-magic 1
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91     2        30000000 lovelace + TxOutDatumNone
158d553c46501685c916b8f409b6cac35f00f5bbc65927eef595268bdc8b2925     1        20000000 lovelace + 1 e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858.54687265616420546f6b656e204c6974746572636f696e + TxOutDatumInline ReferenceTxInsScriptsInlineDatumsInBabbageEra (ScriptDataList [ScriptDataNumber 20000000,ScriptDataNumber 25])


Admin/Owner address:

lawrence@lawrence-iMac:~$ cardano-cli query utxo --address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --cardano-mode --testnet-magic 1
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
158d553c46501685c916b8f409b6cac35f00f5bbc65927eef595268bdc8b2925     0        3551912116 lovelace + TxOutDatumNone
158d553c46501685c916b8f409b6cac35f00f5bbc65927eef595268bdc8b2925     2        2000000 lovelace + 25 67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa.4c6974746572636f696e + TxOutDatumNone
57cd9395c30985c4f5850b97fd42ab72750fe37700256549f4476626ef9338b2     1        2000000 lovelace + 1 e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b.4d65726368616e7420546f6b656e204c6974746572636f696e + TxOutDatumNone
b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2     0        5000000 lovelace + TxOutDatumNone



########################################################################
# mint-tx.sh - Mint littercoin to user pkh
########################################################################

lawrence@lawrence-MacBookAir:~/src/littercoin/scripts$ ./mint-tx.sh preprod
+ '[' -z preprod ']'
+ ENV=preprod
+++ readlink -f ./mint-tx.sh
++ dirname /home/lawrence/src/littercoin/scripts/mint-tx.sh
+ MY_DIR=/home/lawrence/src/littercoin/scripts
+ source /home/lawrence/src/littercoin/scripts/preprod/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export BASE=/home/lawrence/src/littercoin
++ BASE=/home/lawrence/src/littercoin
++ export WORK=/home/lawrence/src/littercoin/work
++ WORK=/home/lawrence/src/littercoin/work
++ export CARDANO_CLI=/usr/local/bin/cardano-cli
++ CARDANO_CLI=/usr/local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ export TESTNET_MAGIC=1
++ TESTNET_MAGIC=1
++ export ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/key.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/key.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/key.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/key.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/key.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/key.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export MIN_ADA_OUTPUT_TX_REF=30000000
++ MIN_ADA_OUTPUT_TX_REF=30000000
++ export COLLATERAL_ADA=5000000
++ COLLATERAL_ADA=5000000
++ export LC_VAL_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2
++ LC_VAL_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2
++ export LC_MINT_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3
++ LC_MINT_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3
++ export MERCHANT_TOKEN_MPH=a227d65452b79c4182c043080140322c65fac517b14e69e8bddf07d4
++ MERCHANT_TOKEN_MPH=a227d65452b79c4182c043080140322c65fac517b14e69e8bddf07d4
++ export MERCHANT_TOKEN_NAME=4d65726368616e7420546f6b656e204c6974746572636f696e
++ MERCHANT_TOKEN_NAME=4d65726368616e7420546f6b656e204c6974746572636f696e
++ export BECH32=/usr/local/bin/bech32
++ BECH32=/usr/local/bin/bech32
++ export ADDR_PREFIX=addr_test
++ ADDR_PREFIX=addr_test
++ export BECH32_NETWORK=00
++ BECH32_NETWORK=00
+ '[' preprod == mainnet ']'
+ network='--testnet-magic 1'
+ echo 'Socket path: /home/lawrence/preprod/node.socket'
Socket path: /home/lawrence/preprod/node.socket
+ ls -al /home/lawrence/preprod/node.socket
srw------- 1 lawrence lawrence 0 Dec  8 08:00 /home/lawrence/preprod/node.socket
+ mkdir -p /home/lawrence/src/littercoin/work
+ mkdir -p /home/lawrence/src/littercoin/work-backup
+ rm -f /home/lawrence/src/littercoin/work/admin-utxo-collateral-valid.json /home/lawrence/src/littercoin/work/admin-utxo-valid.json /home/lawrence/src/littercoin/work/admin-utxo.json /home/lawrence/src/littercoin/work/lc-datum-in.json /home/lawrence/src/littercoin/work/lc-datum-out.json /home/lawrence/src/littercoin/work/lc-validator-utxo.json /home/lawrence/src/littercoin/work/pparms.json /home/lawrence/src/littercoin/work/redeemer-mint.json
+ rm -f '/home/lawrence/src/littercoin/work-backup/*'
+ /usr/local/bin/cardano-cli query protocol-parameters --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/pparms.json
+ thread_token_script=/home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.plutus
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.hash
+ thread_token_mph=e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/tt-token-name.json
++ jq -r .bytes
+ thread_token_name=54687265616420546f6b656e204c6974746572636f696e
+ lc_validator_script=/home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus
++ /usr/local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus --testnet-magic 1
+ lc_validator_script_addr=addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.hash
+ lc_validator_hash=b368512317c8f9f9408d026705d0a36071a641c9700d4f7865e1fdfa
+ lc_mint_script=/home/lawrence/src/littercoin/scripts/preprod/data/lc-minting-policy.plutus
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/lc-minting-policy.hash
+ lc_mint_mph=67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/lc-token-name.json
++ jq -r .bytes
+ lc_token_name=4c6974746572636f696e
+ redeemer_mint_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/redeemer-mint.json
+ redeemer_val_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/redeemer-val-mint.json
+ metadata_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/lc-token-metadata.json
++ cat /home/lawrence/.local/keys/testnet/admin/key.pkh
+ admin_pkh=b9abcf6867519e28042048aa11207214a52e6d5d3288b752d1c27682
+ echo 'starting littercoin mint-tx.sh'
starting littercoin mint-tx.sh
+ lc_amount=25
++ /usr/local/bin/cardano-cli address build --testnet-magic 1 --payment-verification-key-file /home/lawrence/.local/keys/testnet/admin/key.vkey
+ admin_utxo_addr=addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7
+ /usr/local/bin/cardano-cli query utxo --address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --cardano-mode --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/admin-utxo.json
+ cat /home/lawrence/src/littercoin/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 4255d41790cd4dc397a54350de8f681b78f2d7e91695dcc1291c1e1ab7b5a69c#0
++ tr -d '\n'
+ admin_utxo_in=4255d41790cd4dc397a54350de8f681b78f2d7e91695dcc1291c1e1ab7b5a69c#0
+ cat /home/lawrence/src/littercoin/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace == 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0
++ tr -d '\n'
+ admin_utxo_collateral_in=b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0
+ /usr/local/bin/cardano-cli query utxo --address addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/lc-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858"."54687265616420546f6b656e204c6974746572636f696e") 
| .key' /home/lawrence/src/littercoin/work/lc-validator-utxo.json
+ lc_validator_utxo_tx_in=158d553c46501685c916b8f409b6cac35f00f5bbc65927eef595268bdc8b2925#1
++ jq -r 'to_entries[] 
| select(.value.value."e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858"."54687265616420546f6b656e204c6974746572636f696e") 
| .value.inlineDatum' /home/lawrence/src/littercoin/work/lc-validator-utxo.json
+ lc_validator_datum_in='{
  "list": [
    {
      "int": 20000000
    },
    {
      "int": 25
    }
  ]
}'
+ echo -n '{
  "list": [
    {
      "int": 20000000
    },
    {
      "int": 25
    }
  ]
}'
++ jq -r '.list[0].int' /home/lawrence/src/littercoin/work/lc-datum-in.json
+ total_ada=20000000
++ jq -r '.list[1].int' /home/lawrence/src/littercoin/work/lc-datum-in.json
+ total_lc=25
+ new_total_lc=50
+ cat /home/lawrence/src/littercoin/work/lc-datum-in.json
+ jq -c '
  .list[1].int   |= 50'
+ cat /home/lawrence/src/littercoin/scripts/preprod/data/redeemer-mint.json
+ jq -c '
  .fields[0].bytes         |= "b368512317c8f9f9408d026705d0a36071a641c9700d4f7865e1fdfa"'
+ /usr/local/bin/cardano-cli transaction build --babbage-era --cardano-mode --testnet-magic 1 --change-address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --tx-in-collateral b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0 --tx-in 4255d41790cd4dc397a54350de8f681b78f2d7e91695dcc1291c1e1ab7b5a69c#0 --tx-in 158d553c46501685c916b8f409b6cac35f00f5bbc65927eef595268bdc8b2925#1 --spending-tx-in-reference 03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2 --spending-plutus-script-v2 --spending-reference-tx-in-inline-datum-present --spending-reference-tx-in-redeemer-file /home/lawrence/src/littercoin/scripts/preprod/data/redeemer-val-mint.json --mint '25 67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa.4c6974746572636f696e' --mint-tx-in-reference 03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3 --mint-plutus-script-v2 --mint-reference-tx-in-redeemer-file /home/lawrence/src/littercoin/work/redeemer-mint.json --policy-id 67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa --tx-out 'addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l+20000000 + 1 e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858.54687265616420546f6b656e204c6974746572636f696e' --tx-out-inline-datum-file /home/lawrence/src/littercoin/work/lc-datum-out.json --tx-out 'addr_test1vq5s7k4kwqz4rrfe8mm9jz9tpm7c5u93yfwwsaw708yxs5sm70qjg+2000000 + 25 67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa.4c6974746572636f696e' --required-signer-hash b9abcf6867519e28042048aa11207214a52e6d5d3288b752d1c27682 --protocol-params-file /home/lawrence/src/littercoin/work/pparms.json --out-file /home/lawrence/src/littercoin/work/mint-tx-alonzo.body
Estimated transaction fee: Lovelace 403882
+ echo 'tx has been built'
tx has been built
+ /usr/local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/littercoin/work/mint-tx-alonzo.body --testnet-magic 1 --signing-key-file /home/lawrence/.local/keys/testnet/admin/key.skey --out-file /home/lawrence/src/littercoin/work/mint-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /usr/local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/littercoin/work/mint-tx-alonzo.tx --testnet-magic 1
Transaction successfully submitted.

lawrence@lawrence-iMac:~$ cardano-cli query utxo --address addr_test1vq5s7k4kwqz4rrfe8mm9jz9tpm7c5u93yfwwsaw708yxs5sm70qjg --cardano-mode --testnet-magic 1
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
5b483b234378c7a5292c7065a49b3311c16585ed258b754cbe6bd079bad330e7     0        5000000 lovelace + TxOutDatumNone
9b1310968acf31977a96bfda36085daf50726e3aca55612246575f3de2dcc167     2        2000000 lovelace + 25 67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa.4c6974746572636f696e + TxOutDatumNone
aa6f14093b4e623b820be3df0760f5d58df3089a5bc019eeb63fbddd595e3d35     0        97821299 lovelace + TxOutDatumNone
aa6f14093b4e623b820be3df0760f5d58df3089a5bc019eeb63fbddd595e3d35     1        2000000 lovelace + 1 a227d65452b79c4182c043080140322c65fac517b14e69e8bddf07d4.4d65726368616e7420546f6b656e204c6974746572636f696e + TxOutDatumNone


########################################################################
# mint-tx.sh - Mint littercoin using the wrong pkh.
########################################################################


lawrence@lawrence-MacBookAir:~/src/littercoin/scripts$ ./mint-tx.sh preprod
+ '[' -z preprod ']'
+ ENV=preprod
+++ readlink -f ./mint-tx.sh
++ dirname /home/lawrence/src/littercoin/scripts/mint-tx.sh
+ MY_DIR=/home/lawrence/src/littercoin/scripts
+ source /home/lawrence/src/littercoin/scripts/preprod/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export BASE=/home/lawrence/src/littercoin
++ BASE=/home/lawrence/src/littercoin
++ export WORK=/home/lawrence/src/littercoin/work
++ WORK=/home/lawrence/src/littercoin/work
++ export CARDANO_CLI=/usr/local/bin/cardano-cli
++ CARDANO_CLI=/usr/local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ export TESTNET_MAGIC=1
++ TESTNET_MAGIC=1
++ export ADMIN_VKEY=/home/lawrence/.local/keys/testnet/user/user.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/testnet/user/user.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/testnet/user/user.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/testnet/user/user.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/testnet/user/user.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/testnet/user/user.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export MIN_ADA_OUTPUT_TX_REF=30000000
++ MIN_ADA_OUTPUT_TX_REF=30000000
++ export COLLATERAL_ADA=5000000
++ COLLATERAL_ADA=5000000
++ export LC_VAL_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2
++ LC_VAL_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2
++ export LC_MINT_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3
++ LC_MINT_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3
++ export MERCHANT_TOKEN_MPH=e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b
++ MERCHANT_TOKEN_MPH=e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b
++ export MERCHANT_TOKEN_NAME=4d65726368616e7420546f6b656e204c6974746572636f696e
++ MERCHANT_TOKEN_NAME=4d65726368616e7420546f6b656e204c6974746572636f696e
++ export BECH32=/usr/local/bin/bech32
++ BECH32=/usr/local/bin/bech32
++ export ADDR_PREFIX=addr_test
++ ADDR_PREFIX=addr_test
++ export BECH32_NETWORK=00
++ BECH32_NETWORK=00
+ '[' preprod == mainnet ']'
+ network='--testnet-magic 1'
+ echo 'Socket path: /home/lawrence/preprod/node.socket'
Socket path: /home/lawrence/preprod/node.socket
+ ls -al /home/lawrence/preprod/node.socket
srw------- 1 lawrence lawrence 0 Dec  8 08:00 /home/lawrence/preprod/node.socket
+ mkdir -p /home/lawrence/src/littercoin/work
+ mkdir -p /home/lawrence/src/littercoin/work-backup
+ rm -f /home/lawrence/src/littercoin/work/admin-utxo-collateral-valid.json /home/lawrence/src/littercoin/work/admin-utxo-valid.json /home/lawrence/src/littercoin/work/admin-utxo.json /home/lawrence/src/littercoin/work/lc-datum-in.json /home/lawrence/src/littercoin/work/lc-datum-out.json /home/lawrence/src/littercoin/work/lc-validator-utxo.json /home/lawrence/src/littercoin/work/pparms.json /home/lawrence/src/littercoin/work/redeemer-mint.json
+ rm -f '/home/lawrence/src/littercoin/work-backup/*'
+ /usr/local/bin/cardano-cli query protocol-parameters --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/pparms.json
+ thread_token_script=/home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.plutus
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.hash
+ thread_token_mph=e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/tt-token-name.json
++ jq -r .bytes
+ thread_token_name=54687265616420546f6b656e204c6974746572636f696e
+ lc_validator_script=/home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus
++ /usr/local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus --testnet-magic 1
+ lc_validator_script_addr=addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.hash
+ lc_validator_hash=b368512317c8f9f9408d026705d0a36071a641c9700d4f7865e1fdfa
+ lc_mint_script=/home/lawrence/src/littercoin/scripts/preprod/data/lc-minting-policy.plutus
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/lc-minting-policy.hash
+ lc_mint_mph=67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/lc-token-name.json
++ jq -r .bytes
+ lc_token_name=4c6974746572636f696e
+ redeemer_mint_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/redeemer-mint.json
+ redeemer_val_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/redeemer-val-mint.json
+ metadata_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/lc-token-metadata.json
++ cat /home/lawrence/.local/keys/testnet/user/user.pkh
+ admin_pkh=290f5ab67005518d393ef65908ab0efd8a70b1225ce875de79c86852
+ echo 'starting littercoin mint-tx.sh'
starting littercoin mint-tx.sh
+ lc_amount=25
++ /usr/local/bin/cardano-cli address build --testnet-magic 1 --payment-verification-key-file /home/lawrence/.local/keys/testnet/user/user.vkey
+ admin_utxo_addr=addr_test1vq5s7k4kwqz4rrfe8mm9jz9tpm7c5u93yfwwsaw708yxs5sm70qjg
+ /usr/local/bin/cardano-cli query utxo --address addr_test1vq5s7k4kwqz4rrfe8mm9jz9tpm7c5u93yfwwsaw708yxs5sm70qjg --cardano-mode --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/admin-utxo.json
+ cat /home/lawrence/src/littercoin/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 5937f30cc9ea4496ee427fd5dd794a1233ad9f7bd9ed042b3458dfd07cbfb5e2#0
++ tr -d '\n'
+ admin_utxo_in=5937f30cc9ea4496ee427fd5dd794a1233ad9f7bd9ed042b3458dfd07cbfb5e2#0
+ cat /home/lawrence/src/littercoin/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace == 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 5b483b234378c7a5292c7065a49b3311c16585ed258b754cbe6bd079bad330e7#0
++ tr -d '\n'
+ admin_utxo_collateral_in=5b483b234378c7a5292c7065a49b3311c16585ed258b754cbe6bd079bad330e7#0
+ /usr/local/bin/cardano-cli query utxo --address addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/lc-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858"."54687265616420546f6b656e204c6974746572636f696e") 
| .key' /home/lawrence/src/littercoin/work/lc-validator-utxo.json
+ lc_validator_utxo_tx_in=158d553c46501685c916b8f409b6cac35f00f5bbc65927eef595268bdc8b2925#1
++ jq -r 'to_entries[] 
| select(.value.value."e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858"."54687265616420546f6b656e204c6974746572636f696e") 
| .value.inlineDatum' /home/lawrence/src/littercoin/work/lc-validator-utxo.json
+ lc_validator_datum_in='{
  "list": [
    {
      "int": 20000000
    },
    {
      "int": 25
    }
  ]
}'
+ echo -n '{
  "list": [
    {
      "int": 20000000
    },
    {
      "int": 25
    }
  ]
}'
++ jq -r '.list[0].int' /home/lawrence/src/littercoin/work/lc-datum-in.json
+ total_ada=20000000
++ jq -r '.list[1].int' /home/lawrence/src/littercoin/work/lc-datum-in.json
+ total_lc=25
+ new_total_lc=50
+ cat /home/lawrence/src/littercoin/work/lc-datum-in.json
+ jq -c '
  .list[1].int   |= 50'
+ cat /home/lawrence/src/littercoin/scripts/preprod/data/redeemer-mint.json
+ jq -c '
  .fields[0].bytes         |= "b368512317c8f9f9408d026705d0a36071a641c9700d4f7865e1fdfa"'
+ /usr/local/bin/cardano-cli transaction build --babbage-era --cardano-mode --testnet-magic 1 --change-address addr_test1vq5s7k4kwqz4rrfe8mm9jz9tpm7c5u93yfwwsaw708yxs5sm70qjg --tx-in-collateral 5b483b234378c7a5292c7065a49b3311c16585ed258b754cbe6bd079bad330e7#0 --tx-in 5937f30cc9ea4496ee427fd5dd794a1233ad9f7bd9ed042b3458dfd07cbfb5e2#0 --tx-in 158d553c46501685c916b8f409b6cac35f00f5bbc65927eef595268bdc8b2925#1 --spending-tx-in-reference 03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2 --spending-plutus-script-v2 --spending-reference-tx-in-inline-datum-present --spending-reference-tx-in-redeemer-file /home/lawrence/src/littercoin/scripts/preprod/data/redeemer-val-mint.json --mint '25 67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa.4c6974746572636f696e' --mint-tx-in-reference 03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3 --mint-plutus-script-v2 --mint-reference-tx-in-redeemer-file /home/lawrence/src/littercoin/work/redeemer-mint.json --policy-id 67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa --tx-out 'addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l+20000000 + 1 e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858.54687265616420546f6b656e204c6974746572636f696e' --tx-out-inline-datum-file /home/lawrence/src/littercoin/work/lc-datum-out.json --tx-out 'addr_test1vq5s7k4kwqz4rrfe8mm9jz9tpm7c5u93yfwwsaw708yxs5sm70qjg+2000000 + 25 67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa.4c6974746572636f696e' --required-signer-hash 290f5ab67005518d393ef65908ab0efd8a70b1225ce875de79c86852 --protocol-params-file /home/lawrence/src/littercoin/work/pparms.json --out-file /home/lawrence/src/littercoin/work/mint-tx-alonzo.body
Command failed: transaction build  Error: The following scripts have execution failures:
the script for transaction input 0 (in the order of the TxIds) failed with: 
The Plutus script evaluation failed: An error has occurred:  User error:
The machine terminated because of an error, either from a built-in function or from an explicit use of 'error'.
Script debugging logs: LCV4: true
LCV5: true
LCV6: true
LCV7: false



lcValidator.cs
--------------

...
(print("LCV7: " + (tx.is_signed_by(ownerPkh)).show()); 
                        tx.is_signed_by(ownerPkh))
...              
       
       
########################################################################
# burn-tx.sh - Try burning littercoin and recieve Ada with invalid 
# merchant token
########################################################################


lawrence@lawrence-MacBookAir:~/src/littercoin/scripts$ ./burn-tx.sh preprod
+ '[' -z preprod ']'
+ ENV=preprod
+++ readlink -f ./burn-tx.sh
++ dirname /home/lawrence/src/littercoin/scripts/burn-tx.sh
+ MY_DIR=/home/lawrence/src/littercoin/scripts
+ source /home/lawrence/src/littercoin/scripts/preprod/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export BASE=/home/lawrence/src/littercoin
++ BASE=/home/lawrence/src/littercoin
++ export WORK=/home/lawrence/src/littercoin/work
++ WORK=/home/lawrence/src/littercoin/work
++ export CARDANO_CLI=/usr/local/bin/cardano-cli
++ CARDANO_CLI=/usr/local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ export TESTNET_MAGIC=1
++ TESTNET_MAGIC=1
++ export ADMIN_VKEY=/home/lawrence/.local/keys/testnet/user/user.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/testnet/user/user.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/testnet/user/user.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/testnet/user/user.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/testnet/user/user.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/testnet/user/user.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export MIN_ADA_OUTPUT_TX_REF=30000000
++ MIN_ADA_OUTPUT_TX_REF=30000000
++ export COLLATERAL_ADA=5000000
++ COLLATERAL_ADA=5000000
++ export LC_VAL_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2
++ LC_VAL_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2
++ export LC_MINT_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3
++ LC_MINT_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3
++ export MERCHANT_TOKEN_MPH=a227d65452b79c4182c043080140322c65fac517b14e69e8bddf07d4
++ MERCHANT_TOKEN_MPH=a227d65452b79c4182c043080140322c65fac517b14e69e8bddf07d4
++ export MERCHANT_TOKEN_NAME=4d65726368616e7420546f6b656e204c6974746572636f696e
++ MERCHANT_TOKEN_NAME=4d65726368616e7420546f6b656e204c6974746572636f696e
++ export BECH32=/usr/local/bin/bech32
++ BECH32=/usr/local/bin/bech32
++ export ADDR_PREFIX=addr_test
++ ADDR_PREFIX=addr_test
++ export BECH32_NETWORK=00
++ BECH32_NETWORK=00
+ '[' preprod == mainnet ']'
+ network='--testnet-magic 1'
+ echo 'Socket path: /home/lawrence/preprod/node.socket'
Socket path: /home/lawrence/preprod/node.socket
+ ls -al /home/lawrence/preprod/node.socket
srw------- 1 lawrence lawrence 0 Dec  8 08:00 /home/lawrence/preprod/node.socket
+ mkdir -p /home/lawrence/src/littercoin/work
+ mkdir -p /home/lawrence/src/littercoin/work-backup
+ rm -f /home/lawrence/src/littercoin/work/admin-utxo-collateral-valid.json /home/lawrence/src/littercoin/work/admin-utxo-valid.json /home/lawrence/src/littercoin/work/admin-utxo.json /home/lawrence/src/littercoin/work/lc-datum-in.json /home/lawrence/src/littercoin/work/lc-datum-out.json /home/lawrence/src/littercoin/work/lc-validator-utxo.json /home/lawrence/src/littercoin/work/mint-tx-alonzo.body /home/lawrence/src/littercoin/work/mint-tx-alonzo.tx /home/lawrence/src/littercoin/work/pparms.json /home/lawrence/src/littercoin/work/redeemer-mint.json
+ rm -f '/home/lawrence/src/littercoin/work-backup/*'
+ /usr/local/bin/cardano-cli query protocol-parameters --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/pparms.json
+ thread_token_script=/home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.plutus
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.hash
+ thread_token_mph=e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/tt-token-name.json
++ jq -r .bytes
+ thread_token_name=54687265616420546f6b656e204c6974746572636f696e
+ lc_validator_script=/home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus
++ /usr/local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus --testnet-magic 1
+ lc_validator_script_addr=addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.hash
+ lc_validator_hash=b368512317c8f9f9408d026705d0a36071a641c9700d4f7865e1fdfa
+ lc_mint_script=/home/lawrence/src/littercoin/scripts/preprod/data/lc-minting-policy.plutus
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/lc-minting-policy.hash
+ lc_mint_mph=67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/lc-token-name.json
++ jq -r .bytes
+ lc_token_name=4c6974746572636f696e
+ redeemer_burn_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/redeemer-burn.json
+ redeemer_val_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/redeemer-val-burn.json
+ metadata_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/lc-token-metadata.json
++ cat /home/lawrence/.local/keys/testnet/user/user.pkh
+ admin_pkh=290f5ab67005518d393ef65908ab0efd8a70b1225ce875de79c86852
+ echo 'starting littercoin mint-tx.sh'
starting littercoin mint-tx.sh
+ lc_amount=25
++ /usr/local/bin/cardano-cli address build --testnet-magic 1 --payment-verification-key-file /home/lawrence/.local/keys/testnet/user/user.vkey
+ admin_utxo_addr=addr_test1vq5s7k4kwqz4rrfe8mm9jz9tpm7c5u93yfwwsaw708yxs5sm70qjg
+ /usr/local/bin/cardano-cli query utxo --address addr_test1vq5s7k4kwqz4rrfe8mm9jz9tpm7c5u93yfwwsaw708yxs5sm70qjg --cardano-mode --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/admin-utxo.json
+ cat /home/lawrence/src/littercoin/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo aa6f14093b4e623b820be3df0760f5d58df3089a5bc019eeb63fbddd595e3d35#0
++ tr -d '\n'
+ admin_utxo_in=aa6f14093b4e623b820be3df0760f5d58df3089a5bc019eeb63fbddd595e3d35#0
+ cat /home/lawrence/src/littercoin/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace == 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 5b483b234378c7a5292c7065a49b3311c16585ed258b754cbe6bd079bad330e7#0
++ tr -d '\n'
+ admin_utxo_collateral_in=5b483b234378c7a5292c7065a49b3311c16585ed258b754cbe6bd079bad330e7#0
++ jq -r 'to_entries[] 
| select(.value.value."a227d65452b79c4182c043080140322c65fac517b14e69e8bddf07d4"."4d65726368616e7420546f6b656e204c6974746572636f696e") 
| .key' /home/lawrence/src/littercoin/work/admin-utxo.json
+ merch_utxo_tx_in=aa6f14093b4e623b820be3df0760f5d58df3089a5bc019eeb63fbddd595e3d35#1
++ jq -r 'to_entries[] 
| select(.value.value."67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa"."4c6974746572636f696e") 
| .key' /home/lawrence/src/littercoin/work/admin-utxo.json
+ lc_utxo_tx_in=9b1310968acf31977a96bfda36085daf50726e3aca55612246575f3de2dcc167#2
+ /usr/local/bin/cardano-cli query utxo --address addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/lc-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858"."54687265616420546f6b656e204c6974746572636f696e") 
| .key' /home/lawrence/src/littercoin/work/lc-validator-utxo.json
+ lc_validator_utxo_tx_in=9b1310968acf31977a96bfda36085daf50726e3aca55612246575f3de2dcc167#1
++ jq -r 'to_entries[] 
| select(.value.value."e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858"."54687265616420546f6b656e204c6974746572636f696e") 
| .value.inlineDatum' /home/lawrence/src/littercoin/work/lc-validator-utxo.json
+ lc_validator_datum_in='{
  "list": [
    {
      "int": 20000000
    },
    {
      "int": 50
    }
  ]
}'
+ echo -n '{
  "list": [
    {
      "int": 20000000
    },
    {
      "int": 50
    }
  ]
}'
++ jq -r '.list[0].int' /home/lawrence/src/littercoin/work/lc-datum-in.json
+ total_ada=20000000
++ jq -r '.list[1].int' /home/lawrence/src/littercoin/work/lc-datum-in.json
+ total_lc=50
+ withdraw_ada=10000000
+ new_total_ada=10000000
+ new_total_lc=25
+ cat /home/lawrence/src/littercoin/work/lc-datum-in.json
+ jq -c '
  .list[0].int   |= 10000000
| .list[1].int   |= 25'
+ cat /home/lawrence/src/littercoin/scripts/preprod/data/redeemer-burn.json
+ jq -c '
  .fields[0].bytes         |= "b368512317c8f9f9408d026705d0a36071a641c9700d4f7865e1fdfa"'
+ cat /home/lawrence/src/littercoin/scripts/preprod/data/redeemer-val-burn.json
+ jq -c '
  .fields[0].bytes          |= "290f5ab67005518d393ef65908ab0efd8a70b1225ce875de79c86852"'
+ /usr/local/bin/cardano-cli transaction build --babbage-era --cardano-mode --testnet-magic 1 --change-address addr_test1vq5s7k4kwqz4rrfe8mm9jz9tpm7c5u93yfwwsaw708yxs5sm70qjg --tx-in-collateral 5b483b234378c7a5292c7065a49b3311c16585ed258b754cbe6bd079bad330e7#0 --tx-in aa6f14093b4e623b820be3df0760f5d58df3089a5bc019eeb63fbddd595e3d35#0 --tx-in 9b1310968acf31977a96bfda36085daf50726e3aca55612246575f3de2dcc167#2 --tx-in aa6f14093b4e623b820be3df0760f5d58df3089a5bc019eeb63fbddd595e3d35#1 --tx-in 9b1310968acf31977a96bfda36085daf50726e3aca55612246575f3de2dcc167#1 --spending-tx-in-reference 03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2 --spending-plutus-script-v2 --spending-reference-tx-in-inline-datum-present --spending-reference-tx-in-redeemer-file /home/lawrence/src/littercoin/work/redeemer-val-burn.json --mint '-25 67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa.4c6974746572636f696e' --mint-tx-in-reference 03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3 --mint-plutus-script-v2 --mint-reference-tx-in-redeemer-file /home/lawrence/src/littercoin/work/redeemer-burn.json --policy-id 67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa --tx-out 'addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l+10000000 + 1 e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858.54687265616420546f6b656e204c6974746572636f696e' --tx-out-inline-datum-file /home/lawrence/src/littercoin/work/lc-datum-out.json --tx-out addr_test1vq5s7k4kwqz4rrfe8mm9jz9tpm7c5u93yfwwsaw708yxs5sm70qjg+10000000 --tx-out 'addr_test1vq5s7k4kwqz4rrfe8mm9jz9tpm7c5u93yfwwsaw708yxs5sm70qjg+2000000 + 1 a227d65452b79c4182c043080140322c65fac517b14e69e8bddf07d4.4d65726368616e7420546f6b656e204c6974746572636f696e' --protocol-params-file /home/lawrence/src/littercoin/work/pparms.json --out-file /home/lawrence/src/littercoin/work/burn-tx-alonzo.body
Command failed: transaction build  Error: The following scripts have execution failures:
the script for transaction input 0 (in the order of the TxIds) failed with: 
The Plutus script evaluation failed: An error has occurred:  User error:
The machine terminated because of an error, either from a built-in function or from an explicit use of 'error'.
Script debugging logs: LCV10: true
LCV11: true
LCV12: true
LCV13: false



lcValidator.cs
...
(print("LCV13: " + (merchOutTxs.get(2).value.contains(minAda + merchVal)).show());
                        merchOutTxs.get(2).value.contains(minAda + merchVal))
...
                 


########################################################################
# burn-tx.sh - Burn littercoin and recieve Ada with a valid 
# merchant token
########################################################################


lawrence@lawrence-iMac:~$ cardano-cli query utxo --address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --cardano-mode --testnet-magic 1
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
158d553c46501685c916b8f409b6cac35f00f5bbc65927eef595268bdc8b2925     2        2000000 lovelace + 25 67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa.4c6974746572636f696e + TxOutDatumNone
9bcf0cd3511204bcbd66a8239678eb764967b8e254f0f2a5029890dbe368bde1     0        1595417417 lovelace + TxOutDatumNone
9bcf0cd3511204bcbd66a8239678eb764967b8e254f0f2a5029890dbe368bde1     1        2000000 lovelace + 1 e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b.4d65726368616e7420546f6b656e204c6974746572636f696e + TxOutDatumNone
b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2     0        5000000 lovelace + TxOutDatumNone


lawrence@lawrence-iMac:~$ cardano-cli query utxo --address addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l --cardano-mode --testnet-magic 1
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91     2        30000000 lovelace + TxOutDatumNone
9b1310968acf31977a96bfda36085daf50726e3aca55612246575f3de2dcc167     1        20000000 lovelace + 1 e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858.54687265616420546f6b656e204c6974746572636f696e + TxOutDatumInline ReferenceTxInsScriptsInlineDatumsInBabbageEra (ScriptDataList [ScriptDataNumber 20000000,ScriptDataNumber 50])


lawrence@lawrence-MacBookAir:~/src/littercoin/scripts$ ./burn-tx.sh preprod
+ '[' -z preprod ']'
+ ENV=preprod
+++ readlink -f ./burn-tx.sh
++ dirname /home/lawrence/src/littercoin/scripts/burn-tx.sh
+ MY_DIR=/home/lawrence/src/littercoin/scripts
+ source /home/lawrence/src/littercoin/scripts/preprod/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export BASE=/home/lawrence/src/littercoin
++ BASE=/home/lawrence/src/littercoin
++ export WORK=/home/lawrence/src/littercoin/work
++ WORK=/home/lawrence/src/littercoin/work
++ export CARDANO_CLI=/usr/local/bin/cardano-cli
++ CARDANO_CLI=/usr/local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ export TESTNET_MAGIC=1
++ TESTNET_MAGIC=1
++ export ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/key.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/key.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/key.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/key.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/key.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/key.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export MIN_ADA_OUTPUT_TX_REF=30000000
++ MIN_ADA_OUTPUT_TX_REF=30000000
++ export COLLATERAL_ADA=5000000
++ COLLATERAL_ADA=5000000
++ export LC_VAL_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2
++ LC_VAL_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2
++ export LC_MINT_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3
++ LC_MINT_REF_SCRIPT=03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3
++ export MERCHANT_TOKEN_MPH=e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b
++ MERCHANT_TOKEN_MPH=e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b
++ export MERCHANT_TOKEN_NAME=4d65726368616e7420546f6b656e204c6974746572636f696e
++ MERCHANT_TOKEN_NAME=4d65726368616e7420546f6b656e204c6974746572636f696e
++ export BECH32=/usr/local/bin/bech32
++ BECH32=/usr/local/bin/bech32
++ export ADDR_PREFIX=addr_test
++ ADDR_PREFIX=addr_test
++ export BECH32_NETWORK=00
++ BECH32_NETWORK=00
+ '[' preprod == mainnet ']'
+ network='--testnet-magic 1'
+ echo 'Socket path: /home/lawrence/preprod/node.socket'
Socket path: /home/lawrence/preprod/node.socket
+ ls -al /home/lawrence/preprod/node.socket
srw------- 1 lawrence lawrence 0 Dec  8 08:00 /home/lawrence/preprod/node.socket
+ mkdir -p /home/lawrence/src/littercoin/work
+ mkdir -p /home/lawrence/src/littercoin/work-backup
+ rm -f /home/lawrence/src/littercoin/work/admin-utxo-collateral-valid.json /home/lawrence/src/littercoin/work/admin-utxo-valid.json /home/lawrence/src/littercoin/work/admin-utxo.json /home/lawrence/src/littercoin/work/burn-tx-alonzo.body /home/lawrence/src/littercoin/work/burn-tx-alonzo.tx /home/lawrence/src/littercoin/work/lc-datum-in.json /home/lawrence/src/littercoin/work/lc-datum-out.json /home/lawrence/src/littercoin/work/lc-validator-utxo.json /home/lawrence/src/littercoin/work/pparms.json /home/lawrence/src/littercoin/work/redeemer-burn.json /home/lawrence/src/littercoin/work/redeemer-val-burn.json
+ rm -f '/home/lawrence/src/littercoin/work-backup/*'
+ /usr/local/bin/cardano-cli query protocol-parameters --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/pparms.json
+ thread_token_script=/home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.plutus
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/tt-minting-policy.hash
+ thread_token_mph=e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/tt-token-name.json
++ jq -r .bytes
+ thread_token_name=54687265616420546f6b656e204c6974746572636f696e
+ lc_validator_script=/home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus
++ /usr/local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.plutus --testnet-magic 1
+ lc_validator_script_addr=addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/lc-validator.hash
+ lc_validator_hash=b368512317c8f9f9408d026705d0a36071a641c9700d4f7865e1fdfa
+ lc_mint_script=/home/lawrence/src/littercoin/scripts/preprod/data/lc-minting-policy.plutus
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/lc-minting-policy.hash
+ lc_mint_mph=67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa
++ jq -r .bytes
++ cat /home/lawrence/src/littercoin/scripts/preprod/data/lc-token-name.json
+ lc_token_name=4c6974746572636f696e
+ redeemer_burn_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/redeemer-burn.json
+ redeemer_val_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/redeemer-val-burn.json
+ metadata_file_path=/home/lawrence/src/littercoin/scripts/preprod/data/lc-token-metadata.json
++ cat /home/lawrence/.local/keys/testnet/admin/key.pkh
+ admin_pkh=b9abcf6867519e28042048aa11207214a52e6d5d3288b752d1c27682
+ echo 'starting littercoin mint-tx.sh'
starting littercoin mint-tx.sh
+ lc_amount=25
++ /usr/local/bin/cardano-cli address build --testnet-magic 1 --payment-verification-key-file /home/lawrence/.local/keys/testnet/admin/key.vkey
+ admin_utxo_addr=addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7
+ /usr/local/bin/cardano-cli query utxo --address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --cardano-mode --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/admin-utxo.json
+ cat /home/lawrence/src/littercoin/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 9bcf0cd3511204bcbd66a8239678eb764967b8e254f0f2a5029890dbe368bde1#0
++ tr -d '\n'
+ admin_utxo_in=9bcf0cd3511204bcbd66a8239678eb764967b8e254f0f2a5029890dbe368bde1#0
+ cat /home/lawrence/src/littercoin/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace == 5000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0
++ tr -d '\n'
+ admin_utxo_collateral_in=b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0
++ jq -r 'to_entries[] 
| select(.value.value."e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b"."4d65726368616e7420546f6b656e204c6974746572636f696e") 
| .key' /home/lawrence/src/littercoin/work/admin-utxo.json
+ merch_utxo_tx_in=9bcf0cd3511204bcbd66a8239678eb764967b8e254f0f2a5029890dbe368bde1#1
++ jq -r 'to_entries[] 
| select(.value.value."67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa"."4c6974746572636f696e") 
| .key' /home/lawrence/src/littercoin/work/admin-utxo.json
+ lc_utxo_tx_in=158d553c46501685c916b8f409b6cac35f00f5bbc65927eef595268bdc8b2925#2
+ /usr/local/bin/cardano-cli query utxo --address addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/lc-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858"."54687265616420546f6b656e204c6974746572636f696e") 
| .key' /home/lawrence/src/littercoin/work/lc-validator-utxo.json
+ lc_validator_utxo_tx_in=9b1310968acf31977a96bfda36085daf50726e3aca55612246575f3de2dcc167#1
++ jq -r 'to_entries[] 
| select(.value.value."e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858"."54687265616420546f6b656e204c6974746572636f696e") 
| .value.inlineDatum' /home/lawrence/src/littercoin/work/lc-validator-utxo.json
+ lc_validator_datum_in='{
  "list": [
    {
      "int": 20000000
    },
    {
      "int": 50
    }
  ]
}'
+ echo -n '{
  "list": [
    {
      "int": 20000000
    },
    {
      "int": 50
    }
  ]
}'
++ jq -r '.list[0].int' /home/lawrence/src/littercoin/work/lc-datum-in.json
+ total_ada=20000000
++ jq -r '.list[1].int' /home/lawrence/src/littercoin/work/lc-datum-in.json
+ total_lc=50
+ withdraw_ada=10000000
+ new_total_ada=10000000
+ new_total_lc=25
+ cat /home/lawrence/src/littercoin/work/lc-datum-in.json
+ jq -c '
  .list[0].int   |= 10000000
| .list[1].int   |= 25'
+ cat /home/lawrence/src/littercoin/scripts/preprod/data/redeemer-burn.json
+ jq -c '
  .fields[0].bytes         |= "b368512317c8f9f9408d026705d0a36071a641c9700d4f7865e1fdfa"'
+ cat /home/lawrence/src/littercoin/scripts/preprod/data/redeemer-val-burn.json
+ jq -c '
  .fields[0].bytes          |= "b9abcf6867519e28042048aa11207214a52e6d5d3288b752d1c27682"'
+ /usr/local/bin/cardano-cli transaction build --babbage-era --cardano-mode --testnet-magic 1 --change-address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --tx-in-collateral b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0 --tx-in 9bcf0cd3511204bcbd66a8239678eb764967b8e254f0f2a5029890dbe368bde1#0 --tx-in 158d553c46501685c916b8f409b6cac35f00f5bbc65927eef595268bdc8b2925#2 --tx-in 9bcf0cd3511204bcbd66a8239678eb764967b8e254f0f2a5029890dbe368bde1#1 --tx-in 9b1310968acf31977a96bfda36085daf50726e3aca55612246575f3de2dcc167#1 --spending-tx-in-reference 03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#2 --spending-plutus-script-v2 --spending-reference-tx-in-inline-datum-present --spending-reference-tx-in-redeemer-file /home/lawrence/src/littercoin/work/redeemer-val-burn.json --mint '-25 67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa.4c6974746572636f696e' --mint-tx-in-reference 03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91#3 --mint-plutus-script-v2 --mint-reference-tx-in-redeemer-file /home/lawrence/src/littercoin/work/redeemer-burn.json --policy-id 67fcf82bf28050e0fb1682d4eb9a0d6818a85d9e499273460650dafa --tx-out 'addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l+10000000 + 1 e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858.54687265616420546f6b656e204c6974746572636f696e' --tx-out-inline-datum-file /home/lawrence/src/littercoin/work/lc-datum-out.json --tx-out addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7+10000000 --tx-out 'addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7+2000000 + 1 e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b.4d65726368616e7420546f6b656e204c6974746572636f696e' --protocol-params-file /home/lawrence/src/littercoin/work/pparms.json --out-file /home/lawrence/src/littercoin/work/burn-tx-alonzo.body
Estimated transaction fee: Lovelace 502785
+ echo 'tx has been built'
tx has been built
+ /usr/local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/littercoin/work/burn-tx-alonzo.body --testnet-magic 1 --signing-key-file /home/lawrence/.local/keys/testnet/admin/key.skey --out-file /home/lawrence/src/littercoin/work/burn-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /usr/local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/littercoin/work/burn-tx-alonzo.tx --testnet-magic 1
Transaction successfully submitted.


lawrence@lawrence-iMac:~$ cardano-cli query utxo --address addr_test1wzeks5frzly0n72q35pxwpws5ds8rfjpe9cq6nmcvhslm7skqvq4l --cardano-mode --testnet-magic 1
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
03a1bda5440d7ae23980bd82c2c661e574ecf8a51014545b344b4c7c70ca8a91     2        30000000 lovelace + TxOutDatumNone
0c0ce186012486f988b775b6ca57aeaf3313fc01b0f852d7aa0d771ac26e693b     1        10000000 lovelace + 1 e0db2efbdc69be9f190d62f3a1b6d38d119e7a4622f80d11bfa56858.54687265616420546f6b656e204c6974746572636f696e + TxOutDatumInline ReferenceTxInsScriptsInlineDatumsInBabbageEra (ScriptDataList [ScriptDataNumber 10000000,ScriptDataNumber 25])


lawrence@lawrence-iMac:~$ cardano-cli query utxo --address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 --cardano-mode --testnet-magic 1
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
0c0ce186012486f988b775b6ca57aeaf3313fc01b0f852d7aa0d771ac26e693b     0        1596914632 lovelace + TxOutDatumNone
0c0ce186012486f988b775b6ca57aeaf3313fc01b0f852d7aa0d771ac26e693b     2        10000000 lovelace + TxOutDatumNone
0c0ce186012486f988b775b6ca57aeaf3313fc01b0f852d7aa0d771ac26e693b     3        2000000 lovelace + 1 e57b84e97afe75117f906e57e66ca0718e25c9db3c4076f2bf78555b.4d65726368616e7420546f6b656e204c6974746572636f696e + TxOutDatumNone
b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2     0        5000000 lovelace + TxOutDatumNone

















